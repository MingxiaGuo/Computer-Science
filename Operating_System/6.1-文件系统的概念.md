# 6.1.1 文件和文件系统
### 1. 数据的组成

- 数据项

 基本数据项（最小的逻辑数据单位）

 组合数据项

- 记录
 
 是一组相关数据项的集合

- 文件

### 2.文件

 是指记录在外存上的具有文件名的一组相关信息的集合。可分为有结构文件和无结构文件两种。有结构文件是由若干个相关记录组成，而无结构文件则被看成一个字符流。

- 文件属性

 文件名、文件类型、文件长度、文件的物理位置、文件的建立日期以及用户对该文件的存取权限等。

- 文件表示的范围/包含的内容

 源程序、二进制代码、文本文档、数据、表格、声音和图像等。

- 文件的特点

 文件具有保存性

 文件是按名存取

 文件的内容是一组信息的集合

文件、记录和数据项间的层次关系
![](/assets/图片58.png)

### 3.文件系统的主要功能

- 实现按文件名存取文件信息

 名字空间 ~~映射~~ > 存储空间

- 为用户提供统一的和友好的接口

- 实施对文件和文件目录的管理

- 文件存储器空间的分配和回收

- 提供有关文件的共享和保护

文件系统的功能可以从两个方面来看：用户使用角度和系统管理角度。

 从用户使用角度，文件系统主要实现了信息的“按名存取” (文件系统的外部特征）。
 当用户要求系统保存一个已命名的文件时，文件系统根据一定的格式把该文件存放到文件存储器中适当的地方。

 用户需要时，系统根据用户指定的文件名，能够从文件存储器中找出所需要的文件或文件中的某些信息。

 从系统管理角度，文件系统主要实现了文件存储器存储空间的组织分配，文件信息的存储，并对存入的文件进行保护和检索(文件系统的内部特征）。

### 4.文件系统模型

 .


# 6.1.2 文件分类
目的：为了更好地管理和使用文件。科学地分门别类，对不同的文件进行不同的管理，不仅提高了文件的存取速度，对文件的共享和保护也有利。

一般通过文件扩展名的方式来体现文件类型，文件名和扩展名之间用“.”分隔
1.按性质和用途分类

n(1)系统文件：

Ø系统软件的文件，用户通过系统调用或系统提供的专用命令来执行，不允许对其进行读写和修改。

Ø主要有操作系统核心和各种系统应用程序或实用工具程序和数据组成。

Ø例如：ibmbio.com,ibmdos.com,command.com

n(2)库文件：

Ø允许用户进行读取和执行，不允许对其进行修改，主要由各种标准子程序库组成。

Ø例如：C语言、FORTRAN子程序库存放在子目录下 *.LIB,/lib/,/usr/lib/。

n(3)用户文件：

Ø通过操作系统保存的用户文件。

Ø主要由用户的源程序等组成，例如：*.c,*.for,*.f,*DBF,*.OBJ

 "E�gN��]� +

2.按存取控制分类

n只读文件：只允许读文件，而不允许写文件。

 标记为：-r-

n可读可写文件：允许读和写文件。

 标记为：-rw-

n可执行文件：允许执行该文件而不允许读和写。

 标记为：-x-

各个操作系统的保护方法和级别有所不同：

ØDOS操作系统三种保护：系统、隐藏、可写。

ØUNIX或Linux操作系统有九个级别的保护。

 8E��i�a

 ��q4 7
3.按使用情况分类

n临时文件：用于系统在工作过程中产生的中间文件，一般有暂存的目录，正常工作情况下，工作完毕会自动删除，一旦有异常情况往往会残留不少临时文件。

n永久文件: 指一般受系统管理的各种系统和用户文件，经过安装或编辑、编译生成的文件，存放在软盘、硬盘或光盘等外存上。

n档案文件: 系统或一些实用工具软件包在工作过程中记录在案的文挡资料文件，以便查阅历史挡案。

 fo��w� +
4.按用户观点分类(组织形式和处理方式UNIX)

n普通文件(常规文件)

Ø一般是字符流组成的无结构文件。

n目录文件

Ø是由文件的目录信息构成的特殊文件，便于操作系统统一管理。

n特殊文件（设备驱动程序）

Ø在UNIX操作系统中，所有的输入、输出设备都被看作特殊文件。这类文件在查找目录、存取权限验证等处理和使用形式上与普通文件相同。但是，特殊文件的使用是和设备处理程序紧密联系的，因此操作系统必须把对特殊文件的文件操作按设备特性要求转化为对不同设备的I/O操作。

 yle-tu��ma
5.按数据形式分类

n源文件

Ø由源程序和数据构成的文件。

n目标文件

Ø由源程序经过编译，但尚未经过链接程序链接的目标代码。

Ø后缀名为“.OBJ”（DOS系统）或“.o”（UNIX或Linux操作系统）

n可执行文件

Ø目标代码经链接程序链接后形成的可以运行的文件。

Ø编译默认可运行文件：a.out（UNIX或Linux操作系统）或.exe（windows）

# 6.1.3 文件操作
1.最基本文件操作

文件系统以系统调用的方式，为用户提供服务。用户可以通过这些系统调用方便而有效地使用和控制文件。这些系统调用包括：创建文件、打开文件、关闭文件、读文件、写文件和删除文件等最基本的文件操作命令 
n创建文件（Create）：

 当用户想把一批信息作为文件保存时，可用此命令向系统提出建立文件的请求。

 当建立新文件时：

 1）系统为新文件分配必要的外存空间；

 2）在文件系统的目录中为该文件建立一个目录项，目录项中记录新文件的文件名及其在外存的地址等属性。
n删除文件（Delete）：

 当一个文件不再使用时，可用此命令将文件删除。

 删除文件时：

 1）系统从文件目录中找到要删除文件的目录项，使之成为空闲目录项；

 2）回收该文件所占用的存储空间。

 ��I� i n打开文件（Open）：节省文件的操作时间,验证合法性 为了避免用户在每次访问文件时从外存中查找文件目录，以节省文件的操作时间, 系统提供了打开文件命令。 

 系统将文件的属性（目录信息）从外存复制到内存打开文件表中，并返回该表目的编号给用户，建立了用户与文件间的联系。以后若再访问此文件，则利用编号直接在内存中检索，从而节省大量的检索开销，提高了文件的操作速度。

 ��_� i
n关闭文件（Close）:释放系统资源,保证信息的完整性

 若文件暂时不用，应将其关闭。

 关闭文件的功能：将文件的属性从内存打开表中删除，从而切断用户与文件间的联系。

 若在文件打开期间，该文件作过某种修改，则系统将内存中该文件的目录信息写回辅存。文件关闭后，若要再次访问该文件，则必须重新打开。

 > ��_� i
n读文件（Read）:

 读文件：把文件中的数据从外存读入内存的用户区。

 在读一个文件时，应在系统调用中给出文件名和存放读出内容的内存地址。此时，通过内存中的打开文件表查找文件目录项，找到之后，从中得到被读文件在外存的地址，然后从外存中将数据读入内存。

 �����N� �
n写文件（Write）:

 当用户要求对文件添加或修改信息时，可用该命令将信息写入文件。

 在写一个文件时，应在系统调用中给出文件名和要写入信息的内存地址。为此，系统通过内存中的打开文件表查找文件目录项，找到之后就利用目录项中的文件读写指针将信息写入指定文件。

 g��B� �
2.其它文件操作

一类是有关对文件属性进行操作的

n改变文件的文件名

n改变文件的拥有者

n改变对文件的访问权

n查询文件的状态(包括文件类型、大小和拥有者以及对文件的访问权等)

 ��a� i
另一类是有关目录的

n创建一个目录

n删除一个目录

n改变当前目录和工作目录

n实现文件共享的系统调用和对文件系统进行操作的系统调用等。

 ��[ 7p��`��
3.文件的使用
1.当建立一个新文件时：

 建立文件

 写文件

 关闭文件

 � 2.当读一个已存在的文件时： 

 打开文件

 读文件

 关闭文件

 ��_�l


