## 5.4

理想传输的两个特点 
①.传输信道不产生差错；
②.不管发送方以多快速读发送数据，接收方总来得及接收；

### 5.4.1 停止等待协议

（常称之为自动重传请求ARQ(utomatic Repeat request)）

1、基本原理 发送方每发完一个分组就停止发送，等待对方确认，收到确认后再发送下一分组（发送分组和确认分组都无差错地按时到达，如上图(a)所示），发送方只要超过一段时间没有收到确认，就认为刚才发送的分组丢失了，因而重传，所以需要设置超时计时器。超时重传大体分以下三种情况。 
⑴、发送分组出错 ①.发送分组按时到达但出错了（丢弃）；②.发送分组到不了接收方；两种情况接收方都不发确认分组，如上图(b)所示；
⑵、发送分组无差错地按时到达，但确认分组丢失 如上图(c)所示，接收方会收到重复分组，接收方应丢弃这个重复的分组，不交付上层，再次发送确认；
⑶、发送分组无差错地按时到达，但确认分组超时到达 如上图(d)所示，接收方会收到重复分组，接收方应丢弃重复的分组，不交付上层，再次发送确认；
使用这种确认和重传机制，可实现在不可靠的传送网络上实现可靠的传输；实现时应该注意以下3点  
①.发送方发送完全组后，保留分组副本直至收到确认；
②.分组和确认分组必须编号；
③.超时计时器设置重传时间应当比数据在分组传输的平均往返时间长一些；
2、信道利用率 停止等待协议的优点是简单，但缺点是信道利用率太低；

TD 发送分组的时间（精确计算时应扣除传送控制信息（如首部）的时间）；
RTT信号在信道中的往返时间，它取决于信道；
TA确认分组的接受时间(TA <TD) ；
上述公式的分母还应该包含接收方对信息的处理时间（很小而被或略）；
∵RTT>> TD  ∴信道利用率低，为了提高信道利用率采取流水线传输，这就需要连续ARQ协议和活动窗口协议；

### 5.4.2 连续 ARQ 协议



基本原理：发送方维持一个发送窗口，位于该窗口内的多个分组可连续发送，不必每发完一个分组就停顿下来等待对方的确认。接收方一般采用累积确认的方式，即不必对收到的分组逐个发送确认，而是对按序到达的、正确的最后一个分组发送确认，表示到这个分组为止的所有分组都已正确收到了。发送方重新发送确认以后的分组，这种重传机制叫“回退 N机制（go-back-N）”。
若中间分组丢失，即使后面分组均正确收到，接收方也只能对丢失分组之前的分组进行确认，发送方并不知道。丢失分组后分组已正确接收，故从丢失分组起，重新发送
累积确认的优点是：容易实现。缺点是：不能向发送方反映出接收方已经正确收到的所有分组的信息，可见，通信线路质量不好时，连续ARQ会带来负面影响。  
		TCP可靠传输的具体实现需要对连续ARQ协议进行改进（§5.5节详述）。

