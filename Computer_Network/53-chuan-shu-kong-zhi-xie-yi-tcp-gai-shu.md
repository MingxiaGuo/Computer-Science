### 5.3.1 TCP 最主要的特点

### 5.3.2 TCP 的连接



5.1.1、进程之间的通信 
从通信和信息处理的角度看，运输层向它上面的应用层提供通信服务，它属于面向通信部分的最高层，同时也是用户功能中的最低层。
当网络的边缘部分中的两个主机使用网络的核心部分的功能进行端到端的通信时，只有位于网络边缘部分的主机的协议栈才有运输层，而网络核心部分的路由器在转发分组时都只用到下三层的功能。
从IP层角度看，通信两端是两个主机（因为：IP数据报首部写的是主机IP地址），而两个主机进行通信实际上就是两个主机中的应用进程互相通信。
从运输层角度看，通信的真正端点是主机的应用进程，所以这种应用进程之间的通信称之为“端到端的通信”。 
1、运输层的两个重要功能：
⑴、运输层第一个重要功能 通过复用和分用技术为应用进程之间提供端到端的逻辑通信。 
“逻辑通信”的意思是：运输层之间的通信好像是沿水平方向传送；即：应用进程看见的是用户数据好像在两个运输层实体之间的端到端逻辑通信信道中传输。但事实上这两个运输层之间并没有一条水平方向的物理连接，这样运输层向高层用户屏蔽了下面网络核心部分的通讯细节（如网络拓扑、所采用的路由选择协议等）。
复用指的是发送方不同的应用进程都可以使用同一个运输层协议传送数据。
分用指接收方的运输层剥去报文首部后能够把这些数据正确地交付到目的应用进程。 
这是因为：一个主机可能有多个应用进程同时和另一台主机的多个应用进程通讯。比如，用户浏览网页的同时用电子邮件给同一网站发送信息，此时用户运行的浏览器客户进程AP1和电子邮件客户进程AP2分别与网站运行的浏览器服务进程AP3和电子邮件服务进程AP4之间同时进行通讯（如下图5-1所示）；
⑵、运输层有第二个重要功能 对报文进行差错检测，
网络层只对IP数据报首部进行检查，而不检查数据部分。
运输层对报文（包含本层添加的首部和应用层用户的数据部分）进行差错检验。
 
5.1.2、运输层的两个主要协议 TCP协议和UDP协议
1、运输协议数据单元TPDU (Transport Protocol Data Unit) 是指两个对等运输实体在通信时传送的数据单位。
⑴、TCP 传送的数据单元TCP报文段；
⑵、UDP 传送的数据单元UDP 报文 或  用户数据报；
2、TCP/IP 体系中的运输层协议（参见P182表5-1）
 
⑴、传输控制协议 TCP（Transmission Control Protocol） TCP提供可靠的、面向连接的服务，开销较大。TCP在传送数据之前必须先建立连接，数据传送结束后要释放连接。TCP不提供广播或者多播服务。 
⑵、用户数据报协议 UDP（User Datagram Protocol） UDP提供不可靠的、无连接的服务，开销较小。UDP 在传送数据之前不需要先建立连接。对方的运输层在收到 UDP 报文后，不需要给出任何确认。虽然 UDP 不提供可靠交付，但在某些情况下 UDP 是一种最有效的工作方式。
强调解释①.当运输层采用面向连接的 TCP 协议时，TCP 报文段是在运输层抽象的端到端逻辑信道中传送，尽管下面的网络是不可靠的（只提供尽最大努力服务），这种逻辑信道就相当于一条全双工的可靠信道，逻辑信道不知道究竟经过了哪些路由器，而这些路由器也根本不知道上面的运输层是否建立了 TCP 连接。
②.当运输层采用无连接的UDP协议时，这种逻辑通信信道是一条不可靠信道。运输层的 UDP 用户数据报与网际层的IP数据报有很大区别。IP 数据报要经过互连网中许多路由器的存储转发，但 UDP 用户数据报是在运输层的端到端抽象的逻辑信道中传送的。 
3、运输层协议和网络层协议的主要区别 
运输层的TCP 和 UDP 协议为进程之间提供逻辑通信；
网络层的IP 协议为主机之间提供逻辑通信；
5.1.3、运输层的端口
1、端口的概念计算机中的进程是用进程标识符来标志的。为了使运行不同操作系统的计算机的应用进程能够互相通信，就必须用统一的方法对 TCP/IP 体系的应用进程进行标志。解决这个问题的方法就是在运输层使用协议端口号(protocol port number)，或通常简称为端口(port)。
特别注意①.在协议栈各层之间抽象出的协议端口是软件端口。而路由器或交换机上的端口是硬件端口。硬件端口是不同硬件设备进行交互的接口，而软件端口是应用层的各种协议进程与运输层的运输实体之间进行层间信息交互的地址，它是一个16位标识符。②.两个计算机中的进程要相互通信，不仅要知道对方的IP地址，而且要知道对方的端口号。 
2、端口号的分类运输层端口号分两类三种：
⑴、服务器端口使用的端口号①.熟知端口号（系统端口号）：0－1023； 
②.登记端口号：1024－49151 
⑵、客户端端口使用的端口号③.49152－65535
说明：
①.熟知端口号由IANA固定地指派给TCP/IP的应用程序，查询网址：www.iana.org；
②.登记端口号是给没有熟知端口号的应用程序使用的，使用时必须在 IANA 登记，以防重复；Internet Assigned Numbers Authority（IANA互联网编号分配机构）；
常用的熟知端口号
应用
程序	FTP	TELNET	SMTP	DNS	TFTP	HTTP	SNMP	SNMP(trap)
	文件传输协议	远程登录	简单邮件传输协议	域名系统	普通文件传送协议	超文本传输协议	简易网络管理协议	自陷简易网络管理协议
熟知
端口号	21	23	25	53	69	80	161	162
